<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LegalEase | Dashboard</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&display=swap" rel="stylesheet">
  <!-- Font Awesome -->
  <script src="https://kit.fontawesome.com/4ca844b3a8.js" crossorigin="anonymous"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Marked.js -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", Arial, sans-serif;
      background: #fafafa;
      color: #111;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    /* Navbar */
    .navbar {
      background: rgba(0,0,0,0.95);
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 100;
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(212, 160, 23, 0.2);
    }
    .navbar-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .logo {
      font-size: 1.5rem;
      font-weight: bold;
      color: white;
      font-family: "Playfair Display", serif;
      text-shadow: 0 2px 8px rgba(212, 160, 23, 0.3);
      transition: all 0.3s ease;
      position: relative;
      cursor: pointer;
    }
    .logo::after {
      content: '‚öñÔ∏è';
      margin-left: 8px;
      animation: scaleBalance 3s ease-in-out infinite;
      display: inline-block;
    }
    .logo:hover {
      color: #d4a017;
      transform: scale(1.05);
      text-shadow: 0 4px 16px rgba(212, 160, 23, 0.6);
    }
    .nav-links {
      display: flex;
      gap: 0.5rem;
      list-style: none;
      margin: 0;
      padding: 0;
    }
    .nav-links li {
      position: relative;
      overflow: hidden;
    }
    .nav-links li a {
      display: block;
      padding: 0.8rem 1.2rem;
      color: white;
      text-decoration: none;
      font-weight: 500;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      position: relative;
      backdrop-filter: blur(5px);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    .nav-links li a::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(212, 160, 23, 0.4), transparent);
      transition: left 0.6s ease;
    }
    .nav-links li a:hover::before {
      left: 100%;
    }
    .nav-links li a:hover {
      background: rgba(212, 160, 23, 0.15);
      border-color: rgba(212, 160, 23, 0.4);
      color: #d4a017;
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 8px 25px rgba(212, 160, 23, 0.2);
      text-shadow: 0 2px 8px rgba(212, 160, 23, 0.4);
    }
    .nav-links li a:active {
      transform: translateY(0) scale(0.98);
      transition: all 0.1s ease;
    }
    .nav-links li a::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      width: 0;
      height: 2px;
      background: linear-gradient(90deg, #d4a017, #f4c430);
      transform: translateX(-50%);
      transition: width 0.4s ease;
    }
    .nav-links li a:hover::after {
      width: 80%;
    }
    .nav-links li a.active {
      background: rgba(212, 160, 23, 0.2);
      border-color: rgba(212, 160, 23, 0.6);
      color: #d4a017;
    }

    @keyframes scaleBalance {
      0%, 100% { transform: rotate(0deg) scale(1); }
      25% { transform: rotate(-5deg) scale(1.1); }
      75% { transform: rotate(5deg) scale(1.1); }
    }

    /* Main Layout */
    main {
      flex: 1;
      margin-top: 90px;
      padding: 2rem;
      max-width: 1400px;
      margin-left: auto;
      margin-right: auto;
    }

    h1 {
      font-family: "Playfair Display", serif;
      font-size: 2rem;
      margin-bottom: 0.3rem;
    }
    .subtitle {
      color: #555;
      margin-bottom: 2.5rem;
    }

    /* Stats Row */
    .stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    .card {
      background: #fff;
      border-radius: 14px;
      padding: 1.5rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transition: transform 0.25s;
    }
    .card:hover {
      transform: translateY(-5px);
    }
    .card h3 {
      margin: 0;
      font-size: 1rem;
      color: #444;
    }
    .card .value {
      font-size: 1.8rem;
      font-weight: bold;
      margin: 0.4rem 0;
    }
    .card .desc {
      font-size: 0.9rem;
      color: #777;
    }
    .red { color: #e63946; }
    .green { color: #2a9d8f; }
    .gold { color: #d4a017; }

    /* Dashboard Grid */
    .dashboard-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 1.5rem;
      margin-top: 2rem;
    }
    .panel {
      background: #fff;
      border-radius: 14px;
      padding: 1.5rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .panel h2 {
      font-size: 1.2rem;
      margin-bottom: 1rem;
      font-family: "Playfair Display", serif;
    }

    /* Table */
    .doc-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    .doc-table th, .doc-table td {
      padding: 0.8rem 1rem;
      text-align: left;
      border-bottom: 1px solid #eee;
    }
    .doc-table th {
      background: #f8f8f8;
      font-weight: bold;
      color: #333;
    }
    .doc-table tr:last-child td {
      border-bottom: none;
    }
    .risk-high { color: #e63946; font-weight: bold; }
    .risk-medium { color: #d4a017; font-weight: bold; }
    .risk-low { color: #2a9d8f; font-weight: bold; }

    /* Recent Activity */
    .activity-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .activity-item {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.95rem;
      color: #444;
    }
    .activity-item i { color: #2a9d8f; }

    /* Chat Bubbles */
    .bubble {
      margin: 6px 0;
      padding: 10px 14px;
      border-radius: 14px;
      max-width: 75%;
      line-height: 1.4;
      font-size: 14px;
      animation: fadeIn 0.3s ease;
    }
    .user { align-self: flex-end; background: #ddd; color: #000; }
    .bot { align-self: flex-start; background: #111; color: #fff; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(6px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Footer */
    footer {
      background: black;
      text-align: center;
      padding: 1rem;
      font-size: 0.9rem;
      color: #aaa;
    }
  </style>
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar">
    <div class="navbar-container">
      <a href="index.html" class="logo">LegalEase</a>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="dashboard.html" class="active">Dashboard</a></li>
        <li><a href="scan-doc.html">Scan Doc</a></li>
        <li><a href="profile.html">Profile</a></li>
        <li><a href="login.html">Login</a></li>
      </ul>
    </div>
  </nav>

  <!-- Main Content -->
  <main>
    <h1>Dashboard</h1>
    <div class="subtitle">Your document insights at a glance</div>

    <!-- Stats Row -->
    <div class="stats">
      <div class="card">
        <h3><i class="fas fa-file-alt"></i> Total Documents</h3>
        <div class="value">12</div>
        <div class="desc">+3 this month</div>
      </div>
      <div class="card">
        <h3><i class="fas fa-exclamation-triangle"></i> High Risk Issues</h3>
        <div class="value red">8</div>
        <div class="desc">Needs review</div>
      </div>
      <div class="card">
        <h3><i class="fas fa-check-circle"></i> Benefits Found</h3>
        <div class="value green">15</div>
        <div class="desc">Detected in 6 docs</div>
      </div>
      <div class="card">
        <h3><i class="fas fa-chart-line"></i> Avg Risk Score</h3>
        <div class="value gold">62</div>
        <div class="desc">Medium level</div>
      </div>
    </div>

    <!-- Dashboard Grid -->
    <div class="dashboard-grid">
      <!-- Left: Graph -->
      <div class="panel">
        <h2><i class="fas fa-chart-bar"></i> Risk Distribution</h2>
        <canvas id="riskChart"></canvas>
      </div>

      <!-- Right: Activity -->
      <div class="panel">
        <h2><i class="fas fa-history"></i> Recent Activity</h2>
        <ul class="activity-list">
          <li class="activity-item"><i class="fas fa-file-alt"></i> Uploaded Loan Agreement</li>
          <li class="activity-item"><i class="fas fa-exclamation-triangle"></i> 2 High Risks flagged</li>
          <li class="activity-item"><i class="fas fa-check-circle"></i> Found 1 Benefit</li>
          <li class="activity-item"><i class="fas fa-file-alt"></i> Uploaded Rental Contract</li>
        </ul>
      </div>

      <!-- Full-width Chart -->
      <div class="panel" style="grid-column: 1 / -1;">
        <h2><i class="fas fa-chart-line"></i> Documents Uploaded Over Time</h2>
        <canvas id="docsChart"></canvas>
      </div>
    </div>

    <!-- Recent Documents -->
    <div class="panel" style="margin-top:2rem;">
      <h2><i class="fas fa-file-alt"></i> Recent Documents</h2>
      <table class="doc-table">
        <thead>
          <tr>
            <th>Document</th>
            <th>Uploaded On</th>
            <th>Risk</th>
            <th>Insights</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Loan Agreement.pdf</td>
            <td>Jan 14, 2025</td>
            <td class="risk-high">High</td>
            <td>2 risks, 1 benefit</td>
          </tr>
          <tr>
            <td>Rental Contract.docx</td>
            <td>Feb 3, 2025</td>
            <td class="risk-medium">Medium</td>
            <td>1 risk, 2 benefits</td>
          </tr>
          <tr>
            <td>Service Agreement.pdf</td>
            <td>Feb 10, 2025</td>
            <td class="risk-low">Low</td>
            <td>0 risks, 3 benefits</td>
          </tr>
        </tbody>
      </table>
      <div style="text-align:right; margin-top:1rem;">
        <a href="review-docs.html" class="btn" style="background:#111; color:white; text-decoration:none;">
          See More <i class="fas fa-arrow-right"></i>
        </a>
      </div>
    </div>
  </main>

  <!-- Floating Chatbot Bubble -->
  <div id="chatbot-bubble" 
       style="position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px;
              border-radius: 50%; background: #111; color: #fff; display: flex;
              justify-content: center; align-items: center; font-size: 1.5rem;
              cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 200;">
    <i class="fas fa-comment-alt"></i>
  </div>

  <!-- Collapsible Chatbot Window -->
  <div id="chatbot-window" 
       style="position: fixed; bottom: 90px; right: 20px; width: 350px; height: 450px;
              background: #fff; border-radius: 16px; box-shadow: 0 6px 20px rgba(0,0,0,0.25);
              display: none; flex-direction: column; overflow: hidden; z-index: 300;">
    
    <!-- Header -->
    <div class="chat-header" 
         style="background: #000; color: white; padding: 10px; display: flex; justify-content: space-between; align-items: center; font-weight: bold;">
      <span style="display:flex; align-items:center; gap:6px;">
        <i class="fas fa-balance-scale"></i> LegalEase Chatbot
      </span>
      <div style="display:flex; gap:10px;">
        <button id="expand-btn" style="background: transparent; border: none; color: #fff; cursor: pointer;">
          <i class="fas fa-external-link-alt"></i>
        </button>
        <button id="close-chat" style="background: transparent; border: none; color: #fff; cursor: pointer;">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>

    <!-- Chat Body -->
    <div id="chatbot-messages" class="chat-body" 
         style="flex: 1; padding: 1rem; overflow-y: auto; background:#f8f8f8; display:flex; flex-direction:column;">
    </div>

    <!-- Composer -->
    <div class="composer" 
         style="display:flex; gap:8px; padding:10px; border-top:1px solid #ddd; background:#fafafa;">
      <textarea id="chatbot-input" placeholder="Type your question here..." 
                style="flex:1; resize:none; padding:10px; border-radius:10px; border:1px solid #ccc; font-size:14px;"></textarea>
      <button id="chatbot-send" 
              style="background:black; color:white; border:none; padding:0 16px; border-radius:10px; cursor:pointer;">
        <i class="fas fa-paper-plane"></i>
      </button>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <p>¬© 2025 LegalEase | Built with MERN</p>
  </footer>

  <!-- Chart.js Script -->
<!-- Chart.js Script + Chatbot Script -->
<script type="module">
  import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

  // === Charts ===
  const ctx = document.getElementById('riskChart').getContext('2d');
  new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: ['High Risk', 'Medium Risk', 'Low Risk'],
      datasets: [{
        data: [8, 20, 12],
        backgroundColor: ['#e63946', '#d4a017', '#2a9d8f'],
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { position: 'bottom' } }
    }
  });

  const ctx2 = document.getElementById('docsChart').getContext('2d');
  new Chart(ctx2, {
    type: 'line',
    data: {
      labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
      datasets: [{
        label: 'Documents Uploaded',
        data: [2, 4, 6, 3, 8, 5, 7],
        borderColor: '#2a9d8f',
        backgroundColor: 'rgba(42, 157, 143, 0.2)',
        fill: true,
        tension: 0.4,
        pointRadius: 5,
        pointBackgroundColor: '#2a9d8f'
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false } },
      scales: {
        x: { grid: { display: false } },
        y: { beginAtZero: true }
      }
    }
  });

  // === Chatbot ===
  const GEMINI_API_KEY = "AIzaSyA0nkn3-ECmii-kvDrMxOOF1mQ56MTKgZ0"; 
  const genAI = new GoogleGenerativeAI(GEMINI_API_KEY);
  const model = genAI.getGenerativeModel({ model: "gemini-2.0-flash" });

  const bubble = document.getElementById("chatbot-bubble");
  const chatWindow = document.getElementById("chatbot-window");
  const closeBtn = document.getElementById("close-chat");
  const expandBtn = document.getElementById("expand-btn");
  const messages = document.getElementById("chatbot-messages");
  const input = document.getElementById("chatbot-input");
  const sendBtn = document.getElementById("chatbot-send");

  // Toggle chat window
  bubble.addEventListener("click", () => {
    chatWindow.style.display = "flex";
    bubble.style.display = "none";
  });
  closeBtn.addEventListener("click", () => {
    chatWindow.style.display = "none";
    bubble.style.display = "flex";
  });
  expandBtn.addEventListener("click", () => {
    window.location.href = "chatbot.html";
  });

  // Append message
  function appendMessage(text, sender = "bot") {
    const div = document.createElement("div");
    div.style.margin = "6px 0";
    div.style.padding = "8px 12px";
    div.style.borderRadius = "12px";
    div.style.maxWidth = "75%";
    div.style.fontSize = "0.85rem";
    div.style.wordWrap = "break-word";
    div.style.alignSelf = sender === "user" ? "flex-end" : "flex-start";
    div.style.background = sender === "user" ? "#c6f7e2" : "#e1f5fe";
    div.innerText = text;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
  }

  // Send to Gemini
  async function askGemini(prompt) {
    appendMessage(prompt, "user");
    appendMessage("...", "bot"); // typing indicator

    try {
      const result = await model.generateContent(prompt);
      const reply = result.response.text();
      messages.lastChild.remove(); // remove typing indicator
      appendMessage(reply, "bot");
    } catch (err) {
      messages.lastChild.remove();
      appendMessage("‚ö†Ô∏è Error: " + err.message, "bot");
    }
  }

  sendBtn.addEventListener("click", () => {
    const text = input.value.trim();
    if (!text) return;
    input.value = "";
    askGemini(text);
  });

  input.addEventListener("keydown", e => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      sendBtn.click();
    }
  });

  // Initial greeting
  appendMessage("üëã Hi! I‚Äôm LegalEase Bot. How can I help?");
</script>

</body>
</html>
